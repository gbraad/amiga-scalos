Content-Type: text/html


	<HTML><HEAD><TITLE>preferences.library</TITLE></HEAD><BODY BACKGROUND='http://scalos.noname.fr/gfx/backdrop.gif'>
	
	<FONT SIZE="5"><B>preferences.library</B></FONT><P><UL>
	<LI><A HREF="#1">--background--</A></LI>
<LI><A HREF="#2">AllocPrefsHandle</A></LI>
<LI><A HREF="#3">FindPreferences</A></LI>
<LI><A HREF="#4">FreePrefsHandle</A></LI>
<LI><A HREF="#5">GetEntry</A></LI>
<LI><A HREF="#6">GetPreferences</A></LI>
<LI><A HREF="#7">ReadPrefsHandle</A></LI>
<LI><A HREF="#8">RemEntry</A></LI>
<LI><A HREF="#9">SetEntry</A></LI>
<LI><A HREF="#10">SetPreferences</A></LI>
<LI><A HREF="#11">WritePrefsHandle</A></LI>
</UL><P><UL><UL>
<A NAME="1"><BR>    </LI><LI><B><FONT SIZE="4">NAME</FONT></B><UL><BR>	--background<BR><BR></UL><FONT SIZE="4"><B>   PURPOSE<BR></B></FONT><UL>	The preferences.library provides a convenient way to store the<BR>	preferences for your program. All internal management and I/O of your<BR>	data is handled by the library, and is controlled via a simple interface<BR>	which makes use of identifiers and tags to access the data. Multiple<BR>	programs can access the data (held only once in memory) at the same time<BR>	as access is arbitrated through the use of semaphores.<BR><BR>   OVERVIEW<BR>	Most of the data and structures mentioned here will be unavailable to<BR>	the programmer, but it is useful to know, so that the correct use of the<BR>	library can be adhered to.<BR><BR>	* All accesses to a preferences structure must be made through a<BR>	  &quot;PrefsHandle&quot;. A PrefsHandle is accessed by name (maximum of 32<BR>	  unique characters) using AllocPrefsHandle(). Within a PrefsHandle a<BR>	  list of ID's within this handle is stored. The pointer remains valid<BR>	  until you call FreePrefsHandle().<BR><BR>	* The ID's are the first level of separation of preference data. Each<BR>	  ID must be 4 ASCII characters, for example &quot;MAIN&quot;, or &quot;MENU&quot;. For<BR>	  creating the ID you can use the MAKE_ID macro as defined in<BR>	  libraries/iffparse.h. ID's are unique within each PrefsHandle. This<BR>	  means that you can have an ID &quot;MAIN&quot; within two PrefsHandle's<BR>	  and they will be completely different ID's.<BR><BR>	* The second level of separating the data is to use tags. A tag can have<BR>	  any value except 0. The data is stored along with the tag. Tags are<BR>	  unique within an ID the same way an ID is unique within a PrefsHandle.<BR><BR>	This gives the following structure to preferences items:<BR><BR>	                     Main list of all preferences handles<BR>	                             /        |       \<BR>	              ______________/         |        \___________________<BR>	             /                        |                            \<BR>	        PrefsHandle              PrefsHandle      ...          PrefsHandle<BR>	      _/          \_<BR>	     /              \<BR>	    ID        ______ID<BR>	  _/ |\      /   __/ |\<BR>	 /   | \    |   /   /  \         etc.<BR>	Tag+ | Tag+ | Tag+ | Tag+<BR>	Data | Data | Data | Data<BR>	     |      |      |<BR>	   Tag+   Tag+   Tag+<BR>	   Data   Data   Data<BR><BR><BR>	The data can be manipulated in these structures using SetPreferences()<BR>	to set the data and GetPreferences() to retrieve the data.<BR><BR><BR>	There is an alternative way to store the data. You can also have a list<BR>	of data items for each tag value. NB: you cannot mix normal single data<BR>	tags and their functions with the list type tags and their functions.<BR>	This is achieved using SetEntry(), GetEntry() and RemEntry() functions.<BR>	Each data item in the list is accessed using a logical entry number.<BR>	Since the data items are not explicitly accessed using this entry<BR>	number (such as with an array), their positions can change when you add<BR>	items in the middle of the list. For this reason you cannot guarantee<BR>	the order of data items in this sub-list. Applications of this method of<BR>	storing data could be a list of files which your program runs at<BR>	startup, without needing them to be in any specific order.<BR><BR><BR>	FindPreferences() will return a pointer to the tag specified and can be<BR>	used to find whether a certain tag exists or to access the data (if you<BR>	know the internal structure of tag items :). This works for either<BR>	type of tag (single data item or list of data items).<BR><BR>	ReadPrefsHandle() and WritePrefsHandle() can be used to read or write an<BR>	entire PrefsHandle in the specified file.<BR><BR></UL><HR>
<A NAME="2"><BR>
<BR>   </LI><LI><B><FONT SIZE="4">NAME</FONT></B><UL><BR>	AllocPrefsHandle -- Allocate preferences handle<BR><BR></UL><FONT SIZE="4"><B>   SYNOPSIS<BR></B></FONT><PRE>	prefshandle = AllocPrefsHandle( name )<BR>	D0                             A0<BR><BR>	APTR AllocPrefsHandle( CONST_STRPTR );<BR><BR></PRE>&nbsp;<BR><BR><FONT SIZE="4"><B>   FUNCTION<BR></B></FONT><UL>	Allocate a handle so that the preferences inside can be accessed. All<BR>	successful calls to this function must be matched by a call to the<BR>	FreePrefsHandle() function.<BR><BR></UL><FONT SIZE="4"><B>   INPUTS<BR></B></FONT><UL>	name - a string that you can identify the preferences set by<BR><BR></UL><FONT SIZE="4"><B>   RESULT<BR></B></FONT><UL>	prefshandle - a pointer to the newly allocated preferences set or NULL<BR>	              for failure.<BR><BR></UL><FONT SIZE="4"><B>   SEE ALSO<BR></B></FONT><UL>	FreePrefsHandle()<BR><BR></UL><HR>
<A NAME="3"><BR>
<BR>   </LI><LI><B><FONT SIZE="4">NAME</FONT></B><UL><BR>	FindPreferences -- get pointer to data stored for a preference tag<BR><BR></UL><FONT SIZE="4"><B>   SYNOPSIS<BR></B></FONT><PRE>	prefsstruct = FindPreferences(prefshandle, ID, Tag);<BR>	D0                            A0           D0  D1<BR><BR>	struct PrefsStruct *FindPreferences(APTR, ULONG, ULONG);<BR><BR></PRE>&nbsp;<BR><BR><FONT SIZE="4"><B>   FUNCTION<BR></B></FONT><UL>	Searchs for the preferences entry specified by the preferences handle,<BR>	ID and Tag values and returns a pointer to whatever is stored there.<BR>	Similar to GetPreferences() and GetEntry(), but since it does not copy<BR>	any data can be used on both types of tag it can be used to find out<BR>	whether a tag is present in a PrefsHandle.<BR><BR></UL><FONT SIZE="4"><B>   INPUTS<BR></B></FONT><UL>	PrefsHandle   - pointer to a previously successfully allocated<BR>	                preferences handle<BR>	ID            - id of the set within the preferences handle you wish to<BR>	                use<BR>	Tag           - the tag used to identify this preference data within the<BR>	                the ID set<BR><BR></UL><FONT SIZE="4"><B>   RESULT<BR></B></FONT><UL>	prefsstruct - pointer to the preferences item if found, NULL otherwise<BR><BR>   NOTES<BR>	The returned pointer will return a pointer to the tag item, which will<BR>	either be followed by the data (if set with SetPreferences()) or the<BR>	list of sub items (if set by SetEntry()).<BR><BR>   BUGS<BR><BR></UL><FONT SIZE="4"><B>   SEE ALSO<BR></B></FONT><UL>	AllocPrefsHandle(), SetPreferences(), SetEntry(), GetPreferences(),<BR>	GetEntry()<BR><BR></UL><HR>
<A NAME="4"><BR>
<BR>   </LI><LI><B><FONT SIZE="4">NAME</FONT></B><UL><BR>	FreePrefsHandle -- free a previously allocated preferences handle<BR><BR></UL><FONT SIZE="4"><B>   SYNOPSIS<BR></B></FONT><PRE>	FreePrefsHandle(PrefsHandle);<BR>	                A0<BR><BR>	void FreePrefsHandle(APTR);<BR><BR></PRE>&nbsp;<BR><BR><FONT SIZE="4"><B>   FUNCTION<BR></B></FONT><UL>	Frees the preferences set associated with the handle passed into this<BR>	function. This handle can ONLY be created by calling AllocPrefsHandle<BR>	successfully. You MUST NOT use this preferences handle after you free<BR>	it.<BR><BR></UL><FONT SIZE="4"><B>   INPUTS<BR></B></FONT><UL>	PrefsHandle - pointer to the preferences handle successfully allocated<BR>	              using AllocPrefsHandle()<BR><BR></UL><FONT SIZE="4"><B>   RESULT<BR></B></FONT><UL>	nothing<BR><BR></UL><FONT SIZE="4"><B>   SEE ALSO<BR></B></FONT><UL>	AllocPrefsHandle()<BR><BR></UL><HR>
<A NAME="5"><BR>
<BR>   </LI><LI><B><FONT SIZE="4">NAME</FONT></B><UL><BR>	GetEntry -- fills in a user structure from a preferences item<BR><BR></UL><FONT SIZE="4"><B>   SYNOPSIS<BR></B></FONT><PRE>	bytescopied = GetEntry(PrefsHandle, ID, Tag, Struct, Struct_Size, Entry)<BR>	D0                     A0           D0  D1   A1      D2           D3<BR><BR>	ULONG GetEntry(APTR, ULONG, ULONG, APTR, UWORD, ULONG);<BR><BR></PRE>&nbsp;<BR><BR><FONT SIZE="4"><B>   FUNCTION<BR></B></FONT><UL>	Copies the data stored in a preferences item to a struture or area of<BR>	memory supplied by the programmer. The preference item will come from<BR>	the list item at position &quot;Entry&quot; from the list in the Tag / ID /<BR>	preferences handle.<BR><BR></UL><FONT SIZE="4"><B>   INPUTS<BR></B></FONT><UL>	PrefsHandle   - pointer to a previously successfully allocated<BR>	                preferences handle<BR>	ID            - id of the set within the preferences handle you wish to<BR>	                use<BR>	Tag           - the tag used to identify this preference data within the<BR>	                the ID set<BR>	Struct        - pointer to the structure/memory you wish to copy the<BR>	                preferences data to<BR>	Struct_Size   - size of the structure/memory<BR>	Entry         - the position in the Tag's entry list to read this data<BR>	                from<BR><BR></UL><FONT SIZE="4"><B>   RESULT<BR></B></FONT><UL>	bytescopied - the actual number of bytes copied from the preference data<BR>	            to the structure/memory pointer.<BR><BR>   NOTES<BR>	DO NOT MIX this command with Tag's which have had their preference data<BR>	set with SetPreferences. They are different internally. Only use this<BR>	with Tag's used with SetEntry.<BR><BR></UL><FONT SIZE="4"><B>   SEE ALSO<BR></B></FONT><UL>	AllocPrefsHandle(), SetPreferences(), SetEntry()<BR><BR></UL><HR>
<A NAME="6"><BR>
<BR>   </LI><LI><B><FONT SIZE="4">NAME</FONT></B><UL><BR>	GetPreferences -- returns data from a preference item to the programmer<BR><BR></UL><FONT SIZE="4"><B>   SYNOPSIS<BR></B></FONT><PRE>	bytescopied = GetPreferences(PrefsHandle, ID, Tag, Struct, Struct_Size);<BR>	D0                           A0           D0  D1   A1      D2<BR><BR>	ULONG GetPreferences(APTR, ULONG, ULONG, const APTR, UWORD);<BR><BR></PRE>&nbsp;<BR><BR><FONT SIZE="4"><B>   FUNCTION<BR></B></FONT><UL>	Copies the data stored in a preferences item (as referenced the prefs<BR>	handle, ID and Tag values) into a structure/memory that the user passes.<BR>	The number of bytes actually copied will be returned.<BR><BR></UL><FONT SIZE="4"><B>   INPUTS<BR></B></FONT><UL>	PrefsHandle   - pointer to a previously successfully allocated<BR>	                preferences handle<BR>	ID            - id of the set within the preferences handle you wish to<BR>	                use<BR>	Tag           - the tag used to identify this preference data within the<BR>	                the ID set<BR>	Struct        - pointer to the structure/memory you wish to store<BR>	Struct_Size   - size of the structure/memory<BR><BR></UL><FONT SIZE="4"><B>   RESULT<BR></B></FONT><UL>	bytescopied - the actual number of bytes copied from the preference data<BR>	            to the structure/memory pointer.<BR><BR>   NOTES<BR>	This function does nothing if the ID and Tag values are 0, as they are<BR>	not considered valid as an ID or a Tag.<BR><BR>	This function assumes a single preferences item per tag, DO NOT USE IT<BR>	with preferences items set up with the &quot;Entry&quot; functions.<BR><BR></UL><FONT SIZE="4"><B>   SEE ALSO<BR></B></FONT><UL>	AllocPrefsHandle(), SetPreferences()<BR><BR></UL><HR>
<A NAME="7"><BR>
<BR>   </LI><LI><B><FONT SIZE="4">NAME</FONT></B><UL><BR>	ReadPrefsHandle -- Load an entire prefs handle from disk<BR><BR></UL><FONT SIZE="4"><B>   SYNOPSIS<BR></B></FONT><PRE>	ReadPrefsHandle(PrefsHandle, Filename);<BR>	                A0           A1<BR><BR>	void ReadPrefsHandle(APTR, CONST_STRPTR);<BR><BR></PRE>&nbsp;<BR><BR><FONT SIZE="4"><B>   FUNCTION<BR></B></FONT><UL>	Attempts to read data from a file on disk (previously saved with<BR>	WritePrefsHandle) into the specified preferences handle.<BR><BR></UL><FONT SIZE="4"><B>   INPUTS<BR></B></FONT><UL>	PrefsHandle   - pointer to a previously allocated preferences handle<BR>	Filename      - full path and name of file to load from<BR><BR></UL><FONT SIZE="4"><B>   RESULT<BR></B></FONT><UL>	nothing<BR><BR>   NOTES<BR>	Data is stored in memory using SetPreferences() and SetEntry()<BR>	functions.<BR><BR>   BUGS<BR>	Should probably return a value to indicate whether file was read<BR>	successfully or not.<BR><BR></UL><FONT SIZE="4"><B>   SEE ALSO<BR></B></FONT><UL>	AllocPrefsHandle(), WritePrefsHandle(), SetPreferences(), SetEntry()<BR><BR></UL><HR>
<A NAME="8"><BR>
<BR>   </LI><LI><B><FONT SIZE="4">NAME</FONT></B><UL><BR>	RemEntry -- remove an preferences item entry from a Tag that has a list<BR><BR></UL><FONT SIZE="4"><B>   SYNOPSIS<BR></B></FONT><PRE>	success = RemEntry(PrefsHandle, ID, Tag, Entry);<BR>	D0                 A0           D0  D1   D2<BR><BR>	ULONG RemEntry(APTR, ULONG, ULONG, ULONG);<BR><BR></PRE>&nbsp;<BR><BR><FONT SIZE="4"><B>   FUNCTION<BR></B></FONT><UL>	Removes a preferences item, that is in a list at position &quot;Entry&quot;, at<BR>	the given preferences handle, ID and Tag locations.<BR><BR></UL><FONT SIZE="4"><B>   INPUTS<BR></B></FONT><UL>	PrefsHandle   - pointer to a previously successfully allocated<BR>	                preferences handle<BR>	ID            - id of the set within the preferences handle you wish to<BR>	                use<BR>	Tag           - the tag used to identify this preference data within the<BR>	                the ID set<BR>	Entry         - the position in the Tag's entry list to read this data<BR>	                from<BR><BR></UL><FONT SIZE="4"><B>   RESULT<BR></B></FONT><UL>	success - whether the entry was successfully removed or not.<BR><BR>   NOTES<BR>	DO NOT MIX this function with Tag's which have been created with<BR>	SetPreferences.<BR><BR></UL><FONT SIZE="4"><B>   SEE ALSO<BR></B></FONT><UL>	AllocPrefsHandle(), SetPreferences(), SetEntry()<BR><BR></UL><HR>
<A NAME="9"><BR>
<BR>   </LI><LI><B><FONT SIZE="4">NAME</FONT></B><UL><BR>	SetEntry -- adds preference data to a list of entries related to the Tag<BR><BR></UL><FONT SIZE="4"><B>   SYNOPSIS<BR></B></FONT><PRE>	SetEntry(PrefsHandle, ID, Tag, Struct, Struct_Size, Entry)<BR>	         A0           D0  D1   A1      D2           D3<BR><BR>	void SetEntry(APTR, ULONG, ULONG, const APTR, UWORD, ULONG);<BR><BR></PRE>&nbsp;<BR><BR><FONT SIZE="4"><B>   FUNCTION<BR></B></FONT><UL>	Stores some user data in the preferences item in the preferences handle,<BR>	under the specified ID and Tag values. It will be stored at position<BR>	&quot;Entry&quot; in a list of values being stored under the given Tag value.<BR><BR></UL><FONT SIZE="4"><B>   INPUTS<BR></B></FONT><UL>	PrefsHandle   - pointer to a previously successfully allocated<BR>	                preferences handle<BR>	ID            - id of the set within the preferences handle you wish to<BR>	                use<BR>	Tag           - the tag used to identify this preference data within the<BR>	                the ID set<BR>	Struct        - pointer to the structure/memory you wish to store<BR>	Struct_Size   - size of the structure/memory<BR>	Entry         - the position in the Tag's entry list to store this data<BR><BR></UL><FONT SIZE="4"><B>   RESULT<BR></B></FONT><UL>	nothing<BR><BR>   NOTES<BR>	DO NOT MIX this command with Tag values which have been created with<BR>	SetPreferences. They are different internally. If you have previously<BR>	stored data in this PrefsHandle/ID/Tag/Entry combination, it will be<BR>	overwritten if the data sizes are the same, otherwise this new data will<BR>	be inserted at the position specified.<BR><BR>   BUGS<BR>	Since the entry can be added at the end of the list (if the position is<BR>	not found), this means that it can be added at a position not equal to<BR>	the given Entry value. This is not a bug as such, but the function<BR>	should probably return the actual position that it is inserted at. Also,<BR>	the function can fail (when allocating memory) so it should also return<BR>	a value to indicate that failure.<BR><BR></UL><FONT SIZE="4"><B>   SEE ALSO<BR></B></FONT><UL>	AllocPrefsHandle(), SetPreferences()<BR><BR></UL><HR>
<A NAME="10"><BR>
<BR>   </LI><LI><B><FONT SIZE="4">NAME</FONT></B><UL><BR>	SetPreferences -- store data in a preference item<BR><BR></UL><FONT SIZE="4"><B>   SYNOPSIS<BR></B></FONT><PRE>	SetPreferences(PrefsHandle, ID, Tag, Struct, Struct_Size);<BR>	               A0,          D0, D1,  A1,     D2<BR><BR>	void SetPreferences(APTR, ULONG, ULONG, const APTR, UWORD);<BR><BR></PRE>&nbsp;<BR><BR><FONT SIZE="4"><B>   FUNCTION<BR></B></FONT><UL>	Stores a structure of data in the preferences handle, under the given<BR>	ID and tag values.<BR><BR></UL><FONT SIZE="4"><B>   INPUTS<BR></B></FONT><UL>	PrefsHandle   - pointer to a previously successfully allocated<BR>	                preferences handle<BR>	ID            - id of the set within the preferences handle you wish to<BR>	                use<BR>	Tag           - the tag used to identify this preference data within the<BR>	                the ID set<BR>	Struct        - pointer to the structure/memory you wish to store<BR>	Struct_Size   - size of the structure/memory<BR><BR></UL><FONT SIZE="4"><B>   RESULT<BR></B></FONT><UL>	nothing<BR><BR>   NOTES<BR>	This function does nothing if the ID and Tag values are 0, as they are<BR>	not considered valid as an ID or a Tag. This will overwrite any data<BR>	that has previously been stored in this PrefsHandle/ID/Tag combination.<BR><BR>	This sets up a single preferences item for the given tag. DO NOT MIX<BR>	preferences created with this function with the &quot;Entry&quot; commands!!!<BR><BR></UL><FONT SIZE="4"><B>   SEE ALSO<BR></B></FONT><UL>	AllocPrefsHandle()<BR><BR></UL><HR>
<A NAME="11"><BR>
<BR>   </LI><LI><B><FONT SIZE="4">NAME</FONT></B><UL><BR>	WritePrefsHandle -- saves an entire preferences handle to a file<BR><BR></UL><FONT SIZE="4"><B>   SYNOPSIS<BR></B></FONT><PRE>	WritePrefsHandle(PrefsHandle, Filename);<BR>	                 A0           A1<BR><BR>	void WritePrefsHandle(APTR, CONST_STRPTR);<BR><BR></PRE>&nbsp;<BR><BR><FONT SIZE="4"><B>   FUNCTION<BR></B></FONT><UL>	Stores all the data and structure of the preferences handle to a file<BR>	on disk.<BR><BR></UL><FONT SIZE="4"><B>   INPUTS<BR></B></FONT><UL>	PrefsHandle - pointer to a previously allocated preferences handle<BR>	Filename    - full path and name of file to save to<BR><BR></UL><FONT SIZE="4"><B>   RESULT<BR></B></FONT><UL>	nothing<BR><BR>   NOTES<BR>	This function can deal with single or list entries for a Tag value.<BR><BR>   BUGS<BR>	Should probably return a value to show if the file was successfully<BR>	saved or not.<BR><BR></UL><FONT SIZE="4"><B>   SEE ALSO<BR></B></FONT><UL>	AllocPrefsHandle(), ReadPrefsHandle()<BR><BR></UL><HR>
<A NAME="12"><BR>
 
	</LI></UL><P align="right">
	Generated on 30th March 2009 by ad2html.pl v0.87 by <A HREF="http://www.philprice.net" TARGET="_blank">Phil Price</A>
	</BODY></HTML>
	